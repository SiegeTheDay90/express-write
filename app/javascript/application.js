(()=>{"use strict";const e=class{constructor(e,t="notice",n){if(this.type=t,this.parent=e,this.balloon=document.createElement("div"),this.balloon.style.position="relative",this.balloon.classList.add("balloon"),this.balloon.classList.add("error"===this.type?"text-danger":"text-info"),this.balloon.classList.add(t),this.balloon.innerText=n,"error"===this.type){const e=document.createElement("span");e.innerHTML=`<a href="/bug-report?${new URLSearchParams({error:n})}">Report</a>`,e.style.position="absolute",e.style.right="7px",e.style.bottom="4px",this.balloon.appendChild(e)}this.closeButton=document.createElement("span"),this.balloon.appendChild(this.closeButton),this.closeButton.classList.add("close-button"),this.close=this.close.bind(this),this.closeButton.addEventListener("click",this.close),this.opacity=1,this.parent.appendChild(this.balloon)}close(e){this.interval=setInterval((()=>{this.opacity>0?(this.opacity-=.1,this.balloon.style.opacity=this.opacity):(this.balloon.remove(),clearInterval(this.interval))}),20)}};class t{constructor(e,t,n={},a,s){this.bar=document.createElement("progress"),this.action=a,this.maxTime=60,this.status=document.createElement("span"),this.statusBox=document.createElement("p"),this.loadingImage=new Image,this.loadingImage.src="https://cl-helper-development.s3.amazonaws.com/loading-box.gif",this.loadingImage.id="loading-gif",this.timeElapsed=0,this.progressMessages=["Mixing Ink...","Dipping pen...","Shuffling papers...","Thinking...","Writing..."],this.defaultMessage="Writing... This can take a minute.",this.completionCallback||=s,this.popUp=document.createElement("dialog"),this.popUp.id="loadingModal",this.popUp.style={...this.popUp.style,border:"2px solid green",padding:"20px",display:"flex",gap:"10px"},this.popUp.innerHTML='\n      <style>\n      #modal {\n        position: relative;\n        width: 100%;\n        max-width: 600px;\n        margin: 0 auto;\n        padding: 20px;\n        border: 1px solid #ccc;\n        border-radius: 8px;\n        background-color: #fff;\n        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n      }\n      \n      #closeButton {\n        position: absolute;\n        top: 10px;\n        left: 10px;\n        background: none;\n        border: none;\n        font-size: 16px;\n        cursor: pointer;\n      }\n      \n      #modalContent {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n      \n      #modalText {\n        flex: 1;\n        padding-right: 20px;\n      }\n      \n      #modalLinks {\n        display: flex;\n        flex-direction: column;\n        align-items: flex-end;\n      }\n      \n      #modalLinks a {\n        margin-bottom: 10px;\n      }\n      \n      #modalLinks img {\n        width: 85px;\n        height: auto;\n      }\n    </style>      \n      <div id="modal">\n        <div id="modalContent">\n          <div id="modalText">\n            <p>While you wait, consider sharing and following \n              <a href="https://www.linkedin.com/company/write-wise-job-seekers/" target="_blank">ExpressWrite</a>\n              ! It takes a few seconds and means the world to me!\n            </p>\n          </div>\n          <div id="modalLinks">  \n            <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwrite-wise-4d2bfd5abb7a.herokuapp.com%2F&text=ExpressWrite%20is%20a%20project%20built%20by%20one%20developer.%20Test%20it%20out%20for%20free%21" target="_blank">\n              <img src="https://cl-helper-development.s3.amazonaws.com/linkedin-share-button-icon.png" />\n            </a> \n            <br/>\n            <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwrite-wise-4d2bfd5abb7a.herokuapp.com%2F" target="_blank">\n              <img src="https://cl-helper-development.s3.amazonaws.com/facebook-share-button-icon.png" />\n            </a>\n          </div>\n        </div>\n      </div>\n    ',this.popUp.append(document.createElement("br")),this.popUp.append(this.bar),this.statusBox.append(this.status),this.statusBox.append(this.loadingImage),this.popUp.append(this.statusBox),document.querySelector("*").append(this.popUp),this.popUp.showModal(),this.bar.innerText=0,this.bar.max=100,this.status.innerHTML="Getting Started...",fetch(t,n).then((e=>{this.loadingCallback(e)})).catch((e=>{this.failureCallback([e.toString()])}))}incComplete(e){this.complete+=e,this.bar.innerText=this.complete,this.bar.value=this.complete}async loadingCallback(e){if(e.ok){const t=await e.json();this.request_id=t.id,this.interval=setInterval((async()=>{const e=await fetch(`/check/${this.request_id}`),t=await e.json();if(t.complete)clearInterval(this.interval),t.ok?(this.messages=t.messages,this.completionCallback(t.resource_id)):this.failureCallback(JSON.parse(t.messages));else if(this.timeElapsed>this.maxTime){this.status.innerHTML="";const e=document.createElement("p");e.innerText="This is taking longer than usual.";const t=document.createElement("button");return t.innerText="Cancel & Try Again",t.classList.add("btn"),t.classList.add("btn-primary"),t.addEventListener("click",(()=>{this.failureCallback("cancel")})),this.status.append(e),this.status.append(t),void this.status.append(" or wait a little longer!")}this.status.innerText=this.progressMessages.length?this.progressMessages.pop():this.defaultMessage,this.timeElapsed+=5}),5e3)}}async completionCallback(e){this.complete=100,this.bar.innerText=100,this.bar.value=100;let t,n,a=5;switch(this.status.innerText=`Complete! Link ready in ${a}.....`,this.action){case"listings#generate":this.nextPath=`/listings/${e}/`;break;case"letters#generate":this.nextPath=`/letters/${e}/`;break;case"profiles#new":t=JSON.parse(this.messages),n=new URLSearchParams(t).toString(),this.nextPath="/profiles/new?"+n;break;case"profiles#edit":t=JSON.parse(this.messages),n=new URLSearchParams(t).toString(),this.nextPath=`/profiles/${e}/edit?`+n+"&m=Profile+Not+Yet+Saved";break;case"express#generate":this.nextPath=`/temp/${e}`;break;case"express-member#generate":this.nextPath=`/letters/${e}`;break;default:this.nextPath="/"}setTimeout((()=>{this.status.innerHTML=`<a href="${window.location.origin+this.nextPath}">Your Letter</a>`,this.loadingImage.remove()}),5e3),setInterval((()=>{this.status.innerText="Complete! Link ready in "+--a+".".repeat(a)}),990)}failureCallback(t){this.popUp.remove(),"cancel"===t&&(clearInterval(this.interval),t=["Action cancelled."]),console.error("Request Failed: ",t.join("\n"));const n=document.getElementById("alert-container");t.forEach((t=>{new e(n,"error",t)}))}}const n=function(e){e.preventDefault();const n=e.target,a={method:n.querySelector("input[name=_method]")?n.querySelector("input[name=_method]").value:n.method||"GET",body:{},headers:{}};a.headers["Content-Type"]="application/json";const s=n.querySelectorAll("input, textarea, select");let i=new URLSearchParams;s.forEach((e=>{if(e.name)switch(e.type){case"radio":e.checked&&i.append(e.name,e.value);break;case"file":if(a.body.link)break;a.body=e.files[0];const t=document.getElementById("resume-format").value;"PDF"===t?(a.headers["Content-Type"]="application/pdf",i.append("resume-format","PDF")):"DOCX"===t&&(a.headers["Content-Type"]="application/vnd.openxmlformats-officedocument.wordprocessingml.document",i.append("resume-format","DOCX"));break;default:"authenticity_token"===e.name?a.headers["X-CSRF-Token"]=e.value:i.append(e.name,e.value)}})),"application/json"===a.headers["Content-Type"]&&(a.body=JSON.stringify(a.body)),new t(n,n.action+"?"+i.toString(),a,n.dataset?.action)};document.addEventListener("DOMContentLoaded",(()=>{Array.from(document.getElementsByClassName("ajaxForm"))?.forEach((e=>{e.addEventListener("submit",n)}));const t=document.getElementById("alert-container");Array.from(document.getElementsByClassName("balloon-message"))?.forEach((n=>{new e(t,n.dataset.type,n.dataset.text)}))}))})();